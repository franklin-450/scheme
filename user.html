<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scheme Hub - Buy & Download</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>body {
  background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
  color: #f1f1f1;
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background-attachment: fixed;
  background-size: cover;
  background-repeat: no-repeat;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.card {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
  backdrop-filter: blur(10px);
  color: #e0f7fa;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  min-height: 280px;
}

.card:hover {
  transform: translateY(-6px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
}

.card h5 {
  color: #90caf9;
}

.card p {
  font-size: 0.95rem;
  color: #cfd8dc;
}

.btn-pay {
  background-color: #00c853;
  color: white;
  font-weight: 600;
  transition: background-color 0.3s ease;
}

.btn-pay:hover {
  background-color: #00e676;
}

.btn-download {
  background-color: #2962ff;
  color: white;
  font-weight: 600;
  transition: background-color 0.3s ease;
}

.btn-download:hover {
  background-color: #448aff;
}

.btn:disabled {
  background-color: #999 !important;
  cursor: not-allowed;
}

input.form-control {
  background-color: #263238;
  border: 1px solid #455a64;
  color: #ffffff;
  border-radius: 0.5rem;
}

input.form-control::placeholder {
  color: #b0bec5;
}

    .hero-overlay {
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(6px);
  padding: 4rem 2rem;
  text-align: center;
  border-radius: 20px;
  margin: 3rem auto 2rem;
  max-width: 800px;
}

.hero-overlay h1,
.hero-overlay p {
  text-align: center;
  color: #ffffff;
}

.hero-overlay h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 1rem;
}

.hero-overlay p {
  font-size: 1.2rem;
  font-weight: 400;
  margin-bottom: 0;
}


  footer {
    text-align: center;
    font-size: 0.9rem;
    color: #ccc;
    padding: 2rem 1rem;
    margin-top: 2rem;
  }
    body.sidebar-open::before {
    content: '';
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(4px);
    z-index: 1040;
  }
</style>
</head>

<body>
    <div class="background-slide" id="background-slide"></div>
    <!-- Add the following HTML inside <body> but before .hero-overlay -->
<div id="sidebar" class="position-fixed top-0 start-0 vh-100 bg-dark text-white p-3 d-flex flex-column"
     style="width: 250px; z-index: 1050; transform: translateX(-100%); transition: transform 0.3s ease-in-out;">
  <h4 class="mb-4">üìÅ Menu</h4>
  <button class="btn btn-outline-light btn-sm mb-2" onclick="filterByClass('6')">
    <i class="bi bi-funnel-fill me-1"></i> Grade 6
  </button>
  <button class="btn btn-outline-light btn-sm mb-2" onclick="filterByClass('7')">
    <i class="bi bi-funnel-fill me-1"></i> Grade 7
  </button>
  <button class="btn btn-outline-light btn-sm mb-2" onclick="filterByClass('8')">
    <i class="bi bi-funnel-fill me-1"></i> Grade 8
  </button>
  <button class="btn btn-outline-light btn-sm mb-4" onclick="filterByClass('9')">
    <i class="bi bi-funnel-fill me-1"></i> Grade 9
  </button>
  <button class="btn btn-outline-info btn-sm mt-auto" onclick="loadMyDownloadsToggle()">
    <i class="bi bi-folder-check me-1"></i> My Downloads
  </button>
    <button class="btn btn-outline-secondary btn-sm mb-4" onclick="loadSchemes()">
  <i class="bi bi-arrow-counterclockwise me-1"></i> Reset Filters
</button>
</div>

<!-- Toggle Button -->
<button id="toggleSidebar" class="btn btn-primary position-fixed top-0 start-0 m-2" onclick="toggleSidebar()"
        style="z-index: 1100;">
  <i class="bi bi-list"></i> Menu
</button>


    <div class="hero-overlay text-white">
        <h1 data-aos="fade-down">üìö Learning Resource Hub</h1>
        <p data-aos="fade-up">Buy your package before downloading ‚Äì powered by Fintech Super Companies</p>
        <div class="alert alert-info text-dark text-center" role="alert">
    üí∏ Pay KES 100 via M-Pesa to Buy Goods And Services Till <strong>247247</strong>  <br>
    Then send the <strong>Transaction Code eg ( QIHEWYI7I ) </strong> & your email to <a href="https://wa.me/254798927321" target="_blank">WhatsApp here</a> to get verified.
</div>


    </div>

    <div class="row justify-content-center mb-4">
        <div class="col-md-6">
            <input type="text" id="searchBox" class="form-control form-control-lg"
                placeholder="üîç Search by title, subject or class..." oninput="filterSchemes()">
        </div>
    </div>

    <div class="container">
        <h2 class="text-center mb-4" data-aos="fade-up">üõç Available Schemes</h2>
        <div class="row" id="scheme-list"></div>

        <h2 class="text-center my-5" data-aos="fade-up">üìù Revision Papers</h2>
        <div class="row" id="revision-list"></div>
    </div>

    <footer>
        Powered by <strong>Fintech & Edutech</strong> ‚Äî A Franklin's Product
    </footer>

<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
  AOS.init();

  const unsplashImages = [
    'https://source.unsplash.com/featured/?school',
    'https://source.unsplash.com/featured/?education',
    'https://source.unsplash.com/featured/?students',
    'https://source.unsplash.com/featured/?classroom',
    'https://source.unsplash.com/featured/?books',
    'https://source.unsplash.com/featured/?library',
    'https://source.unsplash.com/featured/?onlinelearning'
  ];

  let imgIndex = 0;
  const backgroundDiv = document.getElementById('background-slide');

  function preloadImages(urls, callback) {
    let loaded = 0;
    urls.forEach(url => {
      const img = new Image();
      img.src = url;
      img.onload = img.onerror = () => {
        if (++loaded === urls.length) callback();
      };
    });
  }

  preloadImages(unsplashImages, () => {
    backgroundDiv.style.backgroundImage = `url('${unsplashImages[imgIndex]}')`;
    setInterval(() => {
      imgIndex = (imgIndex + 1) % unsplashImages.length;
      backgroundDiv.style.backgroundImage = `url('${unsplashImages[imgIndex]}')`;
    }, 5000);
  });

  async function loadSchemes() {
    try {
      const res = await fetch("https://server-1-bmux.onrender.com/api/files");
      const files = await res.json();
      const schemeList = document.getElementById("scheme-list");
      const revisionList = document.getElementById("revision-list");

      schemeList.innerHTML = '';
      revisionList.innerHTML = '';

      files.forEach(file => {
        const card = document.createElement("div");
        card.className = "col-md-4 mb-4";
card.setAttribute('data-class', file.class);


        card.innerHTML = `
          <div class="card shadow-lg border-0 p-4 h-100 d-flex flex-column justify-content-between text-white bg-gradient"
               style="background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(12px); border-radius: 20px;" data-aos="fade-up">
            <div>
              <h5 class="fw-bold mb-3">
                <i class="bi bi-file-earmark-text me-2 text-primary"></i>${file.title}
              </h5>
              <p class="mb-2"><i class="bi bi-book me-2 text-warning"></i><strong>Subject:</strong> ${file.subject}</p>
              <p class="mb-2"><i class="bi bi-person-video3 me-2 text-info"></i><strong>Class:</strong> ${file.class}</p>
              <p class="mb-2"><i class="bi bi-calendar-week me-2 text-light"></i><strong>Uploaded:</strong> ${file.date || 'N/A'}</p>
              <p class="mb-2"><i class="bi bi-tags-fill me-2 text-secondary"></i><strong>Type:</strong> ${file.type}</p>
            </div>
            <div class="d-grid gap-2 mt-3">
              <button class="btn btn-outline-warning btn-sm rounded-pill fw-semibold"
                      onclick="promptAndVerify('${file.filename}', this)">
                <i class="bi bi-envelope-check-fill me-1"></i> Verify / Download
              </button>
              <button class="btn btn-outline-success btn-lg rounded-pill fw-bold" disabled>
                <i class="bi bi-cloud-arrow-down-fill me-1"></i> Download File
              </button>
            </div>
          </div>`;

        if (file.type && file.type.toLowerCase() === "revision") {
          revisionList.appendChild(card);
        } else {
          schemeList.appendChild(card);
        }
      });
    } catch (err) {
      Swal.fire("Error", "Failed to load schemes", "error");
    }
  }

function promptAndVerify(filename, btn) {
  Swal.fire({
    title: 'Enter Email to Access File',
    input: 'email',
    inputPlaceholder: 'your-email@example.com',
    showCancelButton: true,
    confirmButtonText: 'Verify Access',
    preConfirm: (email) => {
      if (!email || !email.includes('@')) {
        Swal.showValidationMessage('Please enter a valid email address.');
      }
    }
  }).then(result => {
    if (result.isConfirmed) {
      const email = result.value.trim();
      Swal.fire({ title: 'Verifying...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

      fetch('https://server-1-bmux.onrender.com/api/verify-access', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      })
      .then(res => res.json())
      .then(data => {
        Swal.close();
        if (data.success) {
          const fileUrl = `https://server-1-bmux.onrender.com/files/${filename}?token=${data.token || 'static'}`;

          Swal.fire({
            title: '‚úÖ Access Granted!',
            html: `
              <p>Your download will begin shortly.</p>
              <a href="${fileUrl}" class="btn btn-success mt-3" target="_blank">
                <i class="bi bi-box-arrow-up-right me-1"></i> Open File Manually
              </a>
            `,
            icon: 'success',
            showConfirmButton: false,
            timer: 5000
          });

          // Auto-download (via temporary link)
          const link = document.createElement('a');
          link.href = fileUrl;
          link.download = filename;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);

          // Save in localStorage
          const downloads = JSON.parse(localStorage.getItem('downloads') || '[]');
          if (!downloads.some(d => d.filename === filename)) {
            downloads.push({ filename, token: data.token });
            localStorage.setItem('downloads', JSON.stringify(downloads));
          }

          loadMyDownloads();
        } else {
          Swal.fire('Access Denied ‚ùå', data.message || 'Email not authorized.', 'error');
        }
      })
      .catch(err => {
        Swal.fire('Error', 'Server error. Try again later.', 'error');
      });
    }
  });
}

  function loadMyDownloads() {
    const saved = JSON.parse(localStorage.getItem('downloads') || '[]');
    if (!saved.length) return;

    if (!document.getElementById('my-downloads')) {
      const section = document.createElement('div');
      section.innerHTML = `
        <h3 class="mt-5 text-center text-white">üìú My Downloads</h3>
        <div class="row mt-3" id="my-downloads"></div>`;
      document.querySelector('.container').appendChild(section);
    }

    const list = document.getElementById('my-downloads');
    list.innerHTML = '';
    saved.forEach(item => {
      const card = document.createElement('div');
      card.className = 'col-md-4 mb-4';
      card.innerHTML = `
        <div class="card p-4 border-0 shadow text-white"
             style="background: rgba(10, 10, 10, 0.6); backdrop-filter: blur(10px); border-radius: 18px;">
          <h5><i class="bi bi-check-circle-fill me-2 text-success"></i>${item.filename}</h5>
          <a class="btn btn-outline-light btn-sm rounded-pill mt-2"
             href="https://server-1-bmux.onrender.com/files/${item.filename}?token=${item.token}" download>
            <i class="bi bi-download me-1"></i> Download Again
          </a>
        </div>`;
      list.appendChild(card);
    });
  }

  function filterSchemes() {
    const input = document.getElementById('searchBox').value.toLowerCase();
    const cards = document.querySelectorAll('#scheme-list .card, #revision-list .card');

    cards.forEach(card => {
      const text = card.innerText.toLowerCase();
      card.parentElement.style.display = text.includes(input) ? 'block' : 'none';
    });
  }

  loadSchemes();
  loadMyDownloads();
</script>
    <script>
  let sidebarOpen = false;

  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
      document.body.classList.toggle('sidebar-open');
    const toggleBtn = document.getElementById('toggleSidebar');

    if (sidebarOpen) {
      sidebar.style.transform = 'translateX(-100%)';
      toggleBtn.innerHTML = '<i class="bi bi-list"></i> Menu';
    } else {
      sidebar.style.transform = 'translateX(0)';
      toggleBtn.innerHTML = '<i class="bi bi-x"></i> Close';
    }

    sidebarOpen = !sidebarOpen;
  }

function filterByClass(classValue) {
  const cards = document.querySelectorAll('#scheme-list .col-md-4, #revision-list .col-md-4');

  cards.forEach(card => {
    const cardClass = card.getAttribute('data-class');
    card.style.display = cardClass === classValue ? 'block' : 'none';
  });
}


  function loadMyDownloadsToggle() {
    const section = document.getElementById('my-downloads');
    if (section) {
      section.parentElement.remove();
    } else {
      loadMyDownloads();
    }
  }
</script>


</body>

</html>
